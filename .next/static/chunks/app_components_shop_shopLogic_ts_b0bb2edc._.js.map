{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/meteor/Desktop/AleGo/ale-project/app/components/shop/shopLogic.ts"],"sourcesContent":["// components/shop/shopLogic.ts\n// ⭐ 迁移自原静态 HTML 中的内联 <script>\n// 已移除立即执行函数 IIFE，改为 initShop() 导出\n// 全部 DOM 操作在客户端执行，Next.js SSR 不会报错\n\n\nexport async function initShop() {\n    console.log('[shopLogic] 初始化 shop 页面...');\n  \n    let products: any[] = []\n    // ==== 数据源（可替换为 fetch API）====\n  // ==== 获取数据 ====\n  async function loadProducts() {\n    try {\n      const res = await fetch('/api/getProducts');\n      if (!res.ok) throw new Error('获取商品数据失败');\n      const data: any [] = await res.json();\n      products = data || [];\n      console.log('[shopLogic] 获取到产品数量:', products.length);\n      render();\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  const statusList = ['','预售','现货']\n  const categoryList = ['','Q版','精品','收藏']\n    // const products = [\n    //   {\n    //     id: 'p1',\n    //     title: 'Toy 1',\n    //     price: 120,\n    //     level: 'Collector',\n    //     status: 'In Stock',\n    //     release: '2024-01-01',\n    //     sales: 200,\n    //     fav: 150,\n    //     img: '/images/toy1.jpg',\n    //     desc: 'Description 1',\n    //     sku: 'SKU001'\n    //   },\n    //   {\n    //     id: 'p2',\n    //     title: 'Toy 2',\n    //     price: 800,\n    //     level: 'Premium',\n    //     status: 'Pre-order',\n    //     release: '2024-06-01',\n    //     sales: 350,\n    //     fav: 90,\n    //     img: '/images/toy2.jpg',\n    //     desc: 'Description 2',\n    //     sku: 'SKU002'\n    //   },\n    //   // ...继续加入全部商品\n    // ];\n  \n    interface State {\n      level: string;\n      status: string;\n      minPrice: number;\n      maxPrice: number;\n      sort: string;\n      perPage: number;\n      page: number;\n      favSet: Set<string>;\n      filtersDirty: boolean;\n    }\n  \n    const state: State = {\n      level: 'All',\n      status: 'All',\n      minPrice: 0,\n      maxPrice: 2000,\n      sort: 'new',\n      perPage: 12,\n      page: 1,\n      favSet: new Set<string>(JSON.parse(localStorage.getItem('favSet') || '[]')),\n      filtersDirty: false\n    };\n  \n    // ==== DOM 元素 ====\n    const gridEl = document.getElementById('grid')!;\n    const resultsCountEl = document.getElementById('resultsCount')!;\n    const paginationEl = document.getElementById('pagination')!;\n    const priceMinInput = document.getElementById('priceMin') as HTMLInputElement;\n    const priceMaxInput = document.getElementById('priceMax') as HTMLInputElement;\n    const sortSel = document.getElementById('sortSelect') as HTMLSelectElement;\n    const perPageSel = document.getElementById('perPage') as HTMLSelectElement;\n    const applyBtn = document.getElementById('applyFilters') as HTMLButtonElement;\n  \n    // ==== 工具函数 ====\n    function saveFavSet() {\n      localStorage.setItem('favSet', JSON.stringify([...state.favSet]));\n    }\n  \n    function sortProducts(list: typeof products) {\n      switch (state.sort) {\n        case 'price_asc':\n          return list.sort((a, b) => a.price - b.price);\n        case 'price_desc':\n          return list.sort((a, b) => b.price - a.price);\n        case 'sales_desc':\n          return list.sort((a, b) => b.sales - a.sales);\n        case 'fav_desc':\n          return list.sort((a, b) => b.fav - a.fav);\n        case 'release_asc':\n          return list.sort(\n            (a, b) => new Date(a.release).getTime() - new Date(b.release).getTime()\n          );\n        case 'release_desc':\n          return list.sort(\n            (a, b) => new Date(b.release).getTime() - new Date(a.release).getTime()\n          );\n        case 'new':\n        default:\n          return list;\n      }\n    }\n  \n    function filterProducts() {\n      return products.filter((p) => {\n        return (\n          (state.level === 'All' || p.level === state.level) &&\n          (state.status === 'All' || p.status === state.status) &&\n          p.price >= state.minPrice &&\n          p.price <= state.maxPrice\n        );\n      });\n    }\n  \n    // ==== 渲染函数 ====\n    function render() {\n      const filtered = filterProducts();\n      const sorted = sortProducts(filtered);\n      const total = sorted.length;\n      const start = (state.page - 1) * state.perPage;\n      const end = start + state.perPage;\n      const pageItems = sorted.slice(start, end);\n  \n      resultsCountEl.textContent = `${total} result${total !== 1 ? 's' : ''}`;\n  \n      // 渲染卡片\n      gridEl.innerHTML = '';\n      for (const p of pageItems) {\n        console.log(222,p)\n        const card = document.createElement('div');\n        card.className = 'card';\n        card.innerHTML = `\n        <a href=\"/product/${p.product_id}\"> <img src=\"${p.image}\" alt=\"${p.name}\" class=\"thumb\" /></a>\n          <h3>${p.name}</h3>\n          <div class=\"muted\">${categoryList[p.category_id]} • ${statusList[p.status]}</div>\n          <div>$${p.price}</div>\n          <button data-id=\"${p.product_id}\" class=\"fav-btn\">\n            ${state.favSet.has(p.product_id) ? '♥ Saved' : '♡ Save'}\n          </button>\n        `;\n        gridEl.appendChild(card);\n      }\n  \n      // 渲染分页\n      const totalPages = Math.ceil(total / state.perPage);\n      paginationEl.innerHTML = '';\n      for (let i = 1; i <= totalPages; i++) {\n        const btn = document.createElement('button');\n        btn.textContent = `${i}`;\n        if (i === state.page) btn.classList.add('active');\n        btn.addEventListener('click', () => {\n          state.page = i;\n          render();\n        });\n        paginationEl.appendChild(btn);\n      }\n  \n      // 给收藏按钮绑定事件\n      gridEl.querySelectorAll<HTMLButtonElement>('.fav-btn').forEach((btn) => {\n        btn.addEventListener('click', () => {\n          const id = btn.dataset.id!;\n          if (state.favSet.has(id)) {\n            state.favSet.delete(id);\n          } else {\n            state.favSet.add(id);\n          }\n          saveFavSet();\n          render();\n        });\n      });\n    }\n  \n    // ==== 初始化 UI 事件 ====\n    document.querySelectorAll<HTMLButtonElement>('#levelOptions .chip').forEach((btn) => {\n      btn.onclick = () => {\n        state.level = btn.dataset.value || 'All';\n        state.page = 1;\n        render();\n      };\n    });\n  \n    document.querySelectorAll<HTMLButtonElement>('#statusOptions .chip').forEach((btn) => {\n      btn.onclick = () => {\n        state.status = btn.dataset.value || 'All';\n        state.page = 1;\n        render();\n      };\n    });\n  \n    applyBtn.onclick = () => {\n      state.minPrice = Number(priceMinInput.value || 0);\n      state.maxPrice = Number(priceMaxInput.value || 2000);\n      state.sort = sortSel.value;\n      state.perPage = Number(perPageSel.value);\n      state.page = 1;\n      render();\n    };\n  \n    // ==== 首次渲染 ====\n    loadProducts();\n  }"],"names":[],"mappings":"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","debugId":null}}]
}